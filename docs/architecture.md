# 아키텍처

## 전체 구성도

```
┌─────────────┐     ┌──────────────┐     ┌──────────────┐
│   운영자     │────▶│  Strapi CMS  │────▶│  PostgreSQL  │
│ (콘텐츠 관리)│     │  :1337       │     │  :5432       │
└─────────────┘     └──────┬───────┘     └──────────────┘
                           │ webhook
                           ▼
                    ┌──────────────┐
                    │ Meilisearch  │
                    │  :7700       │
                    └──────┬───────┘
                           │
┌─────────────┐     ┌──────┴───────┐
│   사용자     │────▶│  Next.js     │
│ (공개 위키)  │     │  :3000       │
└─────────────┘     └──────┬───────┘
                           │
┌─────────────┐            │
│   관리자     │────▶ /admin (운영 어드민)
│ (서비스 운영)│
└─────────────┘
```

## 서비스별 역할

### Strapi CMS (apps/cms)
- **역할**: 콘텐츠 운영 전용
- **담당**: 용어/글/자료 등록, 검수, 발행, 예약발행
- **권한**: 콘텐츠 운영자용 RBAC (Author/Reviewer/Publisher)
- **API**: REST API로 발행된 콘텐츠 제공
- **포트**: 기본 1337 (루트 .env의 CMS_PORT)

### Next.js (apps/web)
- **역할**: 공개 UX + 유저/레벨/인증 + 운영 어드민
- **공개 페이지**: 용어 사전, 카테고리, 태그, 초성/A-Z 인덱스, 검색
- **운영 어드민** (/admin): 유저 관리, 레벨/XP, 감사 로그, 통계
- **인증**: Auth.js (LOCAL/SSO/TRUSTED 모드)
- **포트**: 기본 3000 (루트 .env의 WEB_PORT)

### PostgreSQL
- **역할**: Strapi DB + 유저/레벨 DB
- **호환성**: MariaDB로 교체 가능 (DB_TYPE 환경변수)
- **포트**: 기본 5432 (루트 .env의 DATABASE_PORT)

### Meilisearch
- **역할**: 검색 엔진 (자동완성, 오타허용, 빠른 검색)
- **색인 대상**: title, slug, one_liner, summary, tags, aliases
- **포트**: 기본 7700

## 데이터 흐름

### 콘텐츠 발행 흐름
```
운영자 → Strapi에서 용어 작성 (Draft)
       → 검수자 승인 (Review → Published)
       → Strapi webhook → Meilisearch 인덱스 갱신
       → Next.js가 Strapi API로 콘텐츠 조회 → 사용자에게 표시
```

### 검색 흐름
```
사용자 → Next.js 검색바 입력
       → Meilisearch 자동완성 API 호출
       → 검색 결과 표시 (하이라이팅, 오타 허용)
```

### 인증 흐름
```
사용자 → Next.js 로그인 페이지
       → Auth.js 처리 (LOCAL: 이메일/비번, SSO: OIDC, TRUSTED: 헤더)
       → 세션 생성 → 권한에 따른 페이지 접근
```
